<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Un museu imaginari</title>

<style>
:root{
  --bg:#f0f0f3;
  --bgCouleurs:#e1e0dc;
  --txt:#111;
  --muted:rgba(17,17,17,.62);
  --hair:rgba(17,17,17,.12);
  --maxW:1100px;

  /* ✅ scales calculés en JS (fit viewport) */
  --homeFit: 1;
  --couleursFit: 1;
  --esculturasFit: 1;

  --ease:cubic-bezier(.22, 1, .36, 1);
  --tBg:900ms;

  --pad:12px;

  /* micro-parallax (JS) */
  --parX: 0px;
  --parY: 0px;
  --tiltX: 0deg;
  --tiltY: 0deg;
}

*{ box-sizing:border-box; }

html{
  height:100%;
  background:var(--bg);
  color:var(--txt);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  transition:background-color var(--tBg) var(--ease);
}
body{
  margin:0;
  height:100%;
  background:inherit;
  color:inherit;
  overflow:hidden; /* ✅ pas d’ascenseur */
}

/* fond Couleurs (lock + preview hover) */
html.bg-couleurs, html.preview-couleurs{ background:var(--bgCouleurs); }

/* =========================
   Header
   ========================= */
.header{
  position:sticky;
  top:0;
  z-index:10;
  background:linear-gradient(to bottom, rgba(240,240,243,.92), rgba(240,240,243,.76));
  backdrop-filter:blur(8px);
  border-bottom:1px solid var(--hair);
  transition:background var(--tBg) var(--ease);
  padding-top:env(safe-area-inset-top, 0px);
}
html.bg-couleurs .header,
html.preview-couleurs .header{
  background:linear-gradient(to bottom, rgba(225,224,220,.92), rgba(225,224,220,.76));
}

.header-inner{
  max-width:var(--maxW);
  margin:0 auto;
  padding:12px 14px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}

.brand{
  font-size:14px;
  font-weight:600;
  letter-spacing:.22px;
  text-decoration:none;
  color:inherit;
  white-space:nowrap;
}

.nav{
  display:flex;
  gap:8px;
  font-size:13px;
  letter-spacing:.18px;
  align-items:center;
  flex-wrap:wrap;
}
.nav button{
  appearance:none;
  border:0;
  background:none;
  padding:8px 10px;
  margin:0;
  cursor:pointer;
  color:var(--muted);
  font:inherit;
  border-radius:999px;
}
.nav button:hover{ color:var(--txt); background:rgba(17,17,17,.04); }
.nav button:focus-visible{
  outline:2px solid rgba(0,0,0,.25);
  outline-offset:2px;
}

.state{
  font-size:12px;
  color:rgba(17,17,17,.5);
  letter-spacing:.15px;
  white-space:nowrap;
}

@media (max-width:560px){
  .header-inner{ flex-wrap:wrap; gap:8px 10px; }
  .state{ order:3; width:100%; }
}

/* =========================
   Scène : occupe exactement sous header
   ========================= */
.stage{
  width:100%;
  height: calc(100dvh - var(--headerH, 0px));
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding: var(--pad);
}

.scene{
  position:relative;
  width:100%;
  height:100%;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  overflow:hidden;
  perspective:1900px;
  perspective-origin:50% 18%;

  /* ✅ micro-parallax (safe, amplitude auto en JS) */
  transform:
    translate3d(var(--parX), var(--parY), 0)
    rotateX(var(--tiltX))
    rotateY(var(--tiltY));
  transform-style:preserve-3d;
  transition: transform 120ms linear;
}

/* =========================
   Accueil (mosaïque) — fit viewport
   ========================= */
.mosaic{
  display:grid;
  gap:0;
  line-height:0;
  font-size:0;
  background:#fff;
  overflow:hidden;
  transform: scale(var(--homeFit));
  transform-origin: top center;

  transition:
    transform 1.25s var(--ease),
    opacity   1.25s var(--ease),
    filter    1.25s var(--ease);
  will-change:transform,opacity,filter;
}

.mosaic img{ display:block; width:100%; height:auto; margin:0; border:0; }
.top{ grid-column:1 / -1; }

.cell2,.cell3,.cell4{ position:relative; overflow:hidden; }
.hotspot{
  position:absolute; inset:0; display:block;
  background:transparent; cursor:pointer;
  -webkit-tap-highlight-color:transparent;
}

/* =========================
   Overlays
   ========================= */
.overlay{
  position:absolute;
  top:0;
  left:50%;
  transform-origin: top center;

  opacity:0;
  filter: blur(3px);
  pointer-events:none;

  transition:
    transform 1.35s var(--ease),
    opacity   1.35s var(--ease),
    filter    1.35s var(--ease);
  will-change:transform,opacity,filter;
}

/* Couleurs : fit (pas de scroll) */
#couleurs{
  width: min(96vw, var(--maxW));
  transform:
    translateX(-50%)
    translateX(-46%)
    rotateY(18deg)
    translateZ(-120px)
    scale(calc(var(--couleursFit) * .92));
}

/* Esculturas : slide vertical */
#esculturas{
  width: min(96vw, var(--maxW));
  transform:
    translateX(-50%)
    translateY(42%)
    rotateX(-10deg)
    translateZ(-120px)
    scale(calc(var(--esculturasFit) * .92));
}

/* Photos */
#photos{
  width: min(96vw, var(--maxW));
  transform:
    translateX(-50%)
    translateX(46%)
    rotateY(-18deg)
    translateZ(-120px)
    scale(.92);
}
#photos img{ width:100%; height:auto; display:block; }

.scene.preview-couleurs #couleurs,
.scene.preview-esculturas #esculturas,
.scene.preview-photos #photos,
.scene.lock-couleurs #couleurs,
.scene.lock-esculturas #esculturas,
.scene.lock-photos #photos{
  transition-delay:90ms,90ms,90ms;
}

/* PREVIEW — Couleurs */
.scene.preview-couleurs .mosaic{
  transform:
    translateX(30%)
    rotateY(-14deg)
    translateZ(-60px)
    scale(calc(var(--homeFit) * .98));
  opacity:0;
  filter: blur(2px);
}
.scene.preview-couleurs #couleurs{
  transform:
    translateX(-50%)
    translateX(0%)
    rotateY(0deg)
    translateZ(0px)
    scale(var(--couleursFit));
  opacity:1;
  filter: blur(0);
}

/* PREVIEW — Photos */
.scene.preview-photos .mosaic{
  transform:
    translateX(-30%)
    rotateY(14deg)
    translateZ(-60px)
    scale(calc(var(--homeFit) * .98));
  opacity:0;
  filter: blur(2px);
}
.scene.preview-photos #photos{
  transform:
    translateX(-50%)
    translateX(0%)
    rotateY(0deg)
    translateZ(0px)
    scale(1);
  opacity:1;
  filter: blur(0);
}

/* PREVIEW — Esculturas (vertical) */
.scene.preview-esculturas .mosaic{
  transform:
    translateY(24%)
    rotateX(10deg)
    translateZ(-60px)
    scale(calc(var(--homeFit) * .98));
  opacity:0;
  filter: blur(2px);
}
.scene.preview-esculturas #esculturas{
  transform:
    translateX(-50%)
    translateY(0%)
    rotateX(0deg)
    translateZ(0px)
    scale(var(--esculturasFit));
  opacity:1;
  filter: blur(0);
}

/* LOCK */
.scene.lock-couleurs .mosaic,
.scene.lock-esculturas .mosaic,
.scene.lock-photos .mosaic{
  opacity:0;
  filter: blur(2px);
}
.scene.lock-couleurs .mosaic{
  transform:
    translateX(30%)
    rotateY(-14deg)
    translateZ(-60px)
    scale(calc(var(--homeFit) * .98));
}
.scene.lock-photos .mosaic{
  transform:
    translateX(-30%)
    rotateY(14deg)
    translateZ(-60px)
    scale(calc(var(--homeFit) * .98));
}
.scene.lock-esculturas .mosaic{
  transform:
    translateY(24%)
    rotateX(10deg)
    translateZ(-60px)
    scale(calc(var(--homeFit) * .98));
}

.scene.lock-couleurs #couleurs{
  transform:
    translateX(-50%)
    translateX(0%)
    rotateY(0deg)
    translateZ(0px)
    scale(var(--couleursFit));
  opacity:1;
  filter: blur(0);
  pointer-events:auto;
}
.scene.lock-photos #photos{
  transform:
    translateX(-50%)
    translateX(0%)
    rotateY(0deg)
    translateZ(0px)
    scale(1);
  opacity:1;
  filter: blur(0);
  pointer-events:auto;
}
.scene.lock-esculturas #esculturas{
  transform:
    translateX(-50%)
    translateY(0%)
    rotateX(0deg)
    translateZ(0px)
    scale(var(--esculturasFit));
  opacity:1;
  filter: blur(0);
  pointer-events:auto;
}

/* Mobile : 3D plus douce */
@media (max-width:560px){
  .scene{ perspective:1200px; }
  .scene.preview-couleurs .mosaic,
  .scene.lock-couleurs .mosaic{
    transform:
      translateX(18%)
      rotateY(-9deg)
      translateZ(-35px)
      scale(calc(var(--homeFit) * 1.02));
  }
  .scene.preview-photos .mosaic,
  .scene.lock-photos .mosaic{
    transform:
      translateX(-18%)
      rotateY(9deg)
      translateZ(-35px)
      scale(calc(var(--homeFit) * 1.02));
  }
  .scene.preview-esculturas .mosaic,
  .scene.lock-esculturas .mosaic{
    transform:
      translateY(18%)
      rotateX(7deg)
      translateZ(-35px)
      scale(calc(var(--homeFit) * 1.02));
  }
}

/* =========================
   UI “exposition”
   ========================= */
.couleurs-ui,
.esculturas-ui{
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:center;
  padding:10px 0 12px;
  opacity:.92;
  pointer-events:none;
}
.scene.lock-couleurs .couleurs-ui{ pointer-events:auto; }
.scene.lock-esculturas .esculturas-ui{ pointer-events:auto; }

.pill{
  appearance:none;
  border:1px solid rgba(17,17,17,.16);
  background:rgba(255,255,255,.18);
  padding:8px 10px;
  border-radius:999px;
  font:inherit;
  font-size:12px;
  color:rgba(17,17,17,.72);
  cursor:pointer;
  backdrop-filter: blur(8px);
}
.pill:hover{ color:rgba(17,17,17,1); }
.pill[aria-pressed="true"]{
  color:rgba(17,17,17,1);
  border-color:rgba(17,17,17,.24);
  background:rgba(255,255,255,.34);
}

/* =========================
   Couleurs : grille 5x4
   ========================= */
#couleurs .obra-grid{
  width:100%;
  display:grid;
  gap:0;
  grid-template-columns: repeat(5, 1fr);
  line-height:0;
  font-size:0;
  background:transparent;
}
#couleurs .obra-tile{ position:relative; }
#couleurs .obra-tile img{
  display:block;
  width:100%;
  height:auto;
  object-fit:contain;
}
#couleurs .obra-tile a{
  position:absolute;
  inset:0;
  display:block;
  text-indent:-9999px;
  -webkit-tap-highlight-color:transparent;
}
#couleurs .obra-tile a:focus-visible{
  outline:2px solid rgba(0,0,0,.35);
  outline-offset:-2px;
}
#couleurs .obra-tile.is-hidden{ display:none; }

/* =========================
   Esculturas : grille 4x4
   ========================= */
#esculturas .esc-grid{
  width:100%;
  display:grid;
  gap:0;
  grid-template-columns: repeat(4, 1fr);
  line-height:0;
  font-size:0;
  background:transparent;
}
#esculturas .esc-tile{ position:relative; }
#esculturas .esc-tile img{
  display:block;
  width:100%;
  height:auto;
  object-fit:contain;
}
#esculturas .esc-tile a{
  position:absolute;
  inset:0;
  display:block;
  text-indent:-9999px;
  -webkit-tap-highlight-color:transparent;
}
#esculturas .esc-tile a:focus-visible{
  outline:2px solid rgba(0,0,0,.35);
  outline-offset:-2px;
}
#esculturas .esc-tile.is-hidden{ display:none; }

/* =========================
   Lightbox
   ========================= */
.lightbox{
  position:fixed; inset:0;
  z-index:999;
  display:none;
  pointer-events:none;
}
.lightbox.open{ display:block; pointer-events:auto; }

.lb-backdrop{
  position:absolute; inset:0;
  background:rgba(240,240,243,.78);
  backdrop-filter:blur(10px);
  transition:background-color var(--tBg) var(--ease);
}
html.bg-couleurs .lb-backdrop,
html.preview-couleurs .lb-backdrop{
  background:rgba(225,224,220,.82);
}

.lb-figure{
  position:absolute; inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  margin:0;
  padding:
    calc(28px + env(safe-area-inset-top, 0px))
    calc(52px + env(safe-area-inset-right, 0px))
    calc(28px + env(safe-area-inset-bottom, 0px))
    calc(52px + env(safe-area-inset-left, 0px));
}

.lb-swipe{
  width:100%;
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  touch-action: pan-y;
}

#lbImg{
  max-width:min(94vw, 1400px);
  max-height:86vh;
  width:auto; height:auto;
  display:block;
  object-fit:contain;
}

.lb-close,.lb-nav{
  position:absolute;
  border:0;
  background:transparent;
  padding:14px;
  cursor:pointer;
  color:rgba(17,17,17,.75);
  border-radius:14px;
  -webkit-tap-highlight-color:transparent;
}
.lb-close:hover,.lb-nav:hover{ color:rgba(17,17,17,1); }

.lb-close{
  top:calc(10px + env(safe-area-inset-top, 0px));
  right:calc(10px + env(safe-area-inset-right, 0px));
}
.lb-nav{ top:50%; transform:translateY(-50%); }
.lb-prev{ left:calc(6px + env(safe-area-inset-left, 0px)); }
.lb-next{ right:calc(6px + env(safe-area-inset-right, 0px)); }

.lb-close svg,.lb-nav svg{ width:22px; height:22px; display:block; }
.lb-close svg path,.lb-nav svg path{
  fill:none;
  stroke:currentColor;
  stroke-width:1.2;
  stroke-linecap:round;
  stroke-linejoin:round;
}

@media (max-width:560px){
  .lb-figure{
    padding:
      calc(18px + env(safe-area-inset-top, 0px))
      calc(44px + env(safe-area-inset-right, 0px))
      calc(18px + env(safe-area-inset-bottom, 0px))
      calc(44px + env(safe-area-inset-left, 0px));
  }
  #lbImg{ max-height:82vh; }
}

@media (prefers-reduced-motion:reduce){
  *{ transition:none !important; }
  .scene{ transform:none !important; }
}
</style>
</head>

<body>

<header class="header" id="header">
  <div class="header-inner">
    <a class="brand" href="#" id="homeLink">Un museu imaginari</a>

    <nav class="nav" aria-label="Navigation">
      <button type="button" id="navHome">Accueil</button>
      <button type="button" id="navCouleurs">Couleurs</button>
      <button type="button" id="navEsculturas">Esculturas</button>
      <button type="button" id="navPhotos">Photos</button>
      <button type="button" id="navFull" aria-pressed="false" title="Plein écran">Plein écran</button>
    </nav>

    <div class="state" id="stateTxt">Accueil</div>
  </div>
</header>

<div class="stage" id="stage">
  <div class="scene" id="scene">

    <!-- MOSAÏQUE (ACCUEIL) -->
    <div class="mosaic" id="mosaic">
      <img class="top" id="i1" src="https://avantpost-cpu.github.io/depot-quiz/gala2/intro1.jpg" alt="">

      <div class="cell2" id="cell2">
        <img id="i2" src="https://avantpost-cpu.github.io/depot-quiz/gala2/intro2.jpg" alt="">
        <a class="hotspot" href="#" aria-label="Afficher Couleurs" onclick="return false;"></a>
      </div>

      <div class="cell3" id="cell3">
        <img id="i3" src="https://avantpost-cpu.github.io/depot-quiz/gala2/intro3.jpg" alt="">
        <a class="hotspot" href="#" aria-label="Afficher Esculturas" onclick="return false;"></a>
      </div>

      <div class="cell4" id="cell4">
        <img id="i4" src="https://avantpost-cpu.github.io/depot-quiz/gala2/intro4.jpg" alt="">
        <a class="hotspot" href="#" aria-label="Afficher Photos" onclick="return false;"></a>
      </div>
    </div>

    <!-- OVERLAY COULEURS -->
    <div class="overlay" id="couleurs" aria-label="Couleurs">
      <div class="couleurs-ui" aria-label="Exposition thématique">
        <button class="pill" id="thAll" type="button" aria-pressed="true">Tous</button>
        <button class="pill" id="thA" type="button" aria-pressed="false">Série A</button>
        <button class="pill" id="thB" type="button" aria-pressed="false">Série B</button>
      </div>

      <div class="obra-grid" id="obraGrid" aria-label="Mosaïque des œuvres"></div>
    </div>

    <!-- OVERLAY ESCULTURAS -->
    <div class="overlay" id="esculturas" aria-label="Esculturas">
      <div class="esculturas-ui" aria-label="Exposition thématique">
        <button class="pill" id="escAll" type="button" aria-pressed="true">Tous</button>
        <button class="pill" id="escA" type="button" aria-pressed="false">Série A</button>
        <button class="pill" id="escB" type="button" aria-pressed="false">Série B</button>
      </div>

      <div class="esc-grid" id="escGrid" aria-label="Mosaïque des sculptures"></div>
    </div>

    <!-- OVERLAY PHOTOS -->
    <div class="overlay" id="photos" aria-label="Photos">
      <img src="https://avantpost-cpu.github.io/depot-quiz/gala2/photos.png" alt="Photos">
    </div>

    <!-- LIGHTBOX unique (Couleurs + Esculturas) -->
    <div class="lightbox" id="lightbox" aria-hidden="true">
      <div class="lb-backdrop" id="lbBackdrop"></div>

      <figure class="lb-figure" role="dialog" aria-modal="true" aria-label="Agrandissement">
        <div class="lb-swipe" id="lbSwipe" aria-hidden="true">
          <img id="lbImg" alt="">
        </div>

        <button class="lb-close" id="lbClose" type="button" aria-label="Fermer">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M6 6 L18 18 M18 6 L6 18"></path>
          </svg>
        </button>

        <button class="lb-nav lb-prev" id="lbPrev" type="button" aria-label="Image précédente">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M15 5 L7 12 L15 19"></path>
          </svg>
        </button>

        <button class="lb-nav lb-next" id="lbNext" type="button" aria-label="Image suivante">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M9 5 L17 12 L9 19"></path>
          </svg>
        </button>
      </figure>
    </div>

  </div>
</div>

<script>
/* =========================
   ✅ 0) Libellés centralisés (changer ici suffit)
   ========================= */
const LABELS = {
  home: "Accueil",
  couleurs: "Dibuixos i colors",
  esculturas: "Esculturas",
  photos: "Fotos",
  fullscreen: "Plein écran"
};

/* =========================
   1) Calage colonnes accueil sur largeurs réelles
   ========================= */
const mosaic = document.getElementById("mosaic");
const ids = ["i2","i3","i4"];

function setColumns(){
  const imgs = ids.map(id => document.getElementById(id));
  if (imgs.some(img => !img.complete || !img.naturalWidth)) return;
  const w = imgs.map(img => img.naturalWidth);
  mosaic.style.gridTemplateColumns = `${w[0]}fr ${w[1]}fr ${w[2]}fr`;
}
window.addEventListener("load", setColumns);
ids.forEach(id => document.getElementById(id).addEventListener("load", setColumns));

/* =========================
   2) Couleurs = Obra_1..20 (5x4)
   ========================= */
const obraGrid = document.getElementById("obraGrid");
const OBRA_BASE = "https://avantpost-cpu.github.io/depot-quiz/gala2/";
const OBRA_COUNT = 20;

function obraUrl(i){ return `${OBRA_BASE}Obra_${i}_bdf.jpg`; }

function buildObraGrid(){
  const frag = document.createDocumentFragment();
  for (let i = 1; i <= OBRA_COUNT; i++){
    const tile = document.createElement("div");
    tile.className = "obra-tile";
    tile.dataset.index = String(i);

    const img = document.createElement("img");
    img.src = obraUrl(i);
    img.alt = `Œuvre ${i}`;
    img.loading = "lazy";
    img.decoding = "async";

    const a = document.createElement("a");
    a.href = "#";
    a.setAttribute("aria-label", `Agrandir Œuvre ${i}`);
    a.addEventListener("click", (e) => {
      e.preventDefault();
      if (lock !== "couleurs") setLock("couleurs");
      requestAnimationFrame(() => openLightbox("couleurs", i));
    });

    tile.appendChild(img);
    tile.appendChild(a);
    frag.appendChild(tile);
  }
  obraGrid.innerHTML = "";
  obraGrid.appendChild(frag);
}
buildObraGrid();

/* =========================
   2b) Esculturas = 16 PNG (4x4) depuis /esculturas/
   NOMS EXACTS fournis
   ========================= */
const escGrid = document.getElementById("escGrid");

/* ⚠️ IMPORTANT :
   tu avais écrit "https://.../gala2/Esculturas/" (avec majuscule + dans gala2)
   or tu m'avais dit dossier /esculturas à la racine.
   ✅ Je remets la version correcte : /esculturas/ (minuscule) */
const ESC_BASE = "https://avantpost-cpu.github.io/depot-quiz/gala2/Esculturas/";

const ESC_FILES = [
  "Statuette_8_bdf.png",
  "Statuette_8_2_bdf.png",
  "Statuette_7_bdf.png",
  "Statuette_7_4_bdf.png",
  "Statuette_7_3_bdf.png",
  "Statuette_7_2_bdf.png",
  "Statuette_6_bdf.png",
  "Statuette_6_3_bdf.png",
  "Statuette_6_2_bdf.png",
  "Statuette_4_bdf.png",
  "Statuette_4_2_bdf.png",
  "Statuette_3_bdf.png",
  "Statuette_3_3_bdf.png",
  "Statuette_3_2_bdf.png",
  "Statuette_2_bdf.png",
  "Statuette_2_2_bdf.png"
];
const ESC_COUNT = ESC_FILES.length;

function escUrl(i){
  return ESC_BASE + ESC_FILES[i - 1]; // i=1..16
}

function buildEscGrid(){
  const frag = document.createDocumentFragment();

  ESC_FILES.forEach((file, idx) => {
    const i = idx + 1;

    const tile = document.createElement("div");
    tile.className = "esc-tile";
    tile.dataset.index = String(i);

    const img = document.createElement("img");
    img.src = ESC_BASE + file;
    img.alt = `Sculpture ${i}`;
    img.loading = "lazy";
    img.decoding = "async";

    const a = document.createElement("a");
    a.href = "#";
    a.setAttribute("aria-label", `Agrandir Sculpture ${i}`);
    a.addEventListener("click", (e) => {
      e.preventDefault();
      if (lock !== "esculturas") setLock("esculturas");
      requestAnimationFrame(() => openLightbox("esculturas", i));
    });

    tile.appendChild(img);
    tile.appendChild(a);
    frag.appendChild(tile);
  });

  escGrid.innerHTML = "";
  escGrid.appendChild(frag);
}
buildEscGrid();

/* =========================
   2bis) Exposition thématique (Couleurs)
   ========================= */
const thAll = document.getElementById("thAll");
const thA   = document.getElementById("thA");
const thB   = document.getElementById("thB");

function setPressed(btn, list){
  list.forEach(b => b.setAttribute("aria-pressed", String(b === btn)));
}
function applyThemeCouleurs(mode){
  const tiles = obraGrid.querySelectorAll(".obra-tile");
  tiles.forEach(t => {
    const idx = Number(t.dataset.index || "0");
    let show = true;
    if (mode === "A") show = (idx % 2 === 1);
    if (mode === "B") show = (idx % 2 === 0);
    t.classList.toggle("is-hidden", !show);
  });
  fitAll();
}
thAll.addEventListener("click", ()=>{ setPressed(thAll, [thAll,thA,thB]); applyThemeCouleurs("ALL"); });
thA.addEventListener("click",   ()=>{ setPressed(thA,   [thAll,thA,thB]); applyThemeCouleurs("A"); });
thB.addEventListener("click",   ()=>{ setPressed(thB,   [thAll,thA,thB]); applyThemeCouleurs("B"); });

/* =========================
   2ter) Exposition thématique (Esculturas)
   ========================= */
const escAll = document.getElementById("escAll");
const escA   = document.getElementById("escA");
const escB   = document.getElementById("escB");

function applyThemeEsculturas(mode){
  const tiles = escGrid.querySelectorAll(".esc-tile");
  tiles.forEach(t => {
    const idx = Number(t.dataset.index || "0");
    let show = true;
    if (mode === "A") show = (idx % 2 === 1);
    if (mode === "B") show = (idx % 2 === 0);
    t.classList.toggle("is-hidden", !show);
  });
  fitAll();
}
escAll.addEventListener("click", ()=>{ setPressed(escAll, [escAll,escA,escB]); applyThemeEsculturas("ALL"); });
escA.addEventListener("click",   ()=>{ setPressed(escA,   [escAll,escA,escB]); applyThemeEsculturas("A"); });
escB.addEventListener("click",   ()=>{ setPressed(escB,   [escAll,escA,escB]); applyThemeEsculturas("B"); });

/* =========================
   3) Lightbox + swipe mobile (unique)
   ========================= */
const lightbox   = document.getElementById("lightbox");
const lbBackdrop = document.getElementById("lbBackdrop");
const lbImg      = document.getElementById("lbImg");
const lbSwipe    = document.getElementById("lbSwipe");
const lbClose    = document.getElementById("lbClose");
const lbPrev     = document.getElementById("lbPrev");
const lbNext     = document.getElementById("lbNext");

let lbIndex = 1;
let lbMode  = "couleurs"; // "couleurs" | "esculturas"

function isLightboxOpen(){ return lightbox.classList.contains("open"); }
function getCount(){ return lbMode === "esculturas" ? ESC_COUNT : OBRA_COUNT; }
function getUrl(i){ return lbMode === "esculturas" ? escUrl(i) : obraUrl(i); }
function getAlt(i){ return lbMode === "esculturas" ? `Sculpture ${i}` : `Œuvre ${i}`; }

function setLbImage(index){
  const count = getCount();
  lbIndex = index;
  if (lbIndex < 1) lbIndex = count;
  if (lbIndex > count) lbIndex = 1;
  lbImg.src = getUrl(lbIndex);
  lbImg.alt = getAlt(lbIndex);
}
function prevImage(){ setLbImage(lbIndex - 1); }
function nextImage(){ setLbImage(lbIndex + 1); }

function openLightbox(mode, index){
  if (mode === "couleurs" && lock !== "couleurs") return;
  if (mode === "esculturas" && lock !== "esculturas") return;

  lbMode = mode;
  setLbImage(index);

  lightbox.classList.add("open");
  lightbox.setAttribute("aria-hidden","false");
  lbClose.focus({ preventScroll:true });
}
function closeLightbox(){
  lightbox.classList.remove("open");
  lightbox.setAttribute("aria-hidden","true");
  lbImg.removeAttribute("src");
}

lbClose.addEventListener("click", closeLightbox);
lbBackdrop.addEventListener("click", closeLightbox);
lbPrev.addEventListener("click", prevImage);
lbNext.addEventListener("click", nextImage);

/* swipe horizontal */
let sx=null, sy=null;
lbSwipe.addEventListener("touchstart", (e)=>{
  if(!e.touches?.length) return;
  sx = e.touches[0].clientX;
  sy = e.touches[0].clientY;
},{passive:true});

lbSwipe.addEventListener("touchend", (e)=>{
  if(sx===null||sy===null) return;
  const t = e.changedTouches?.[0];
  if(!t){ sx=sy=null; return; }
  const dx = t.clientX - sx;
  const dy = t.clientY - sy;
  sx=sy=null;
  if (Math.abs(dy) > Math.abs(dx)) return;
  if (Math.abs(dx) < 40) return;
  if (dx > 0) prevImage(); else nextImage();
},{passive:true});

/* =========================
   4) Preview + Lock + Menu + fond
   ========================= */
const scene    = document.getElementById("scene");
const stageEl  = document.getElementById("stage");
const headerEl = document.getElementById("header");

const cell2    = document.getElementById("cell2");
const cell3    = document.getElementById("cell3");
const cell4    = document.getElementById("cell4");

const stateTxt = document.getElementById("stateTxt");
const navHome  = document.getElementById("navHome");
const navCouleurs = document.getElementById("navCouleurs");
const navEsculturas = document.getElementById("navEsculturas");
const navPhotos   = document.getElementById("navPhotos");
const homeLink = document.getElementById("homeLink");
const navFull  = document.getElementById("navFull");

const couleursEl = document.getElementById("couleurs");
const esculturasEl = document.getElementById("esculturas");

let lock = null; // null | "couleurs" | "esculturas" | "photos"

/* ✅ applique les libellés (changer LABELS suffit) */
navHome.textContent = LABELS.home;
navCouleurs.textContent = LABELS.couleurs;
navEsculturas.textContent = LABELS.esculturas;
navPhotos.textContent = LABELS.photos;
navFull.textContent = LABELS.fullscreen;

/* ✅ met à jour aussi les aria-labels des hotspots (pour cohérence) */
cell2.querySelector(".hotspot")?.setAttribute("aria-label", `Afficher ${LABELS.couleurs}`);
cell3.querySelector(".hotspot")?.setAttribute("aria-label", `Afficher ${LABELS.esculturas}`);
cell4.querySelector(".hotspot")?.setAttribute("aria-label", `Afficher ${LABELS.photos}`);

function setStateLabel(){
  stateTxt.textContent =
    lock === "couleurs"    ? LABELS.couleurs
  : lock === "esculturas"  ? LABELS.esculturas
  : lock === "photos"      ? LABELS.photos
  : LABELS.home;
}

function syncBg(previewCouleurs=false){
  const lockedCouleurs = (lock === "couleurs");
  const wantsCouleurs = lockedCouleurs || previewCouleurs;
  document.documentElement.classList.toggle("bg-couleurs", lockedCouleurs);
  document.documentElement.classList.toggle("preview-couleurs", wantsCouleurs && !lockedCouleurs);
}

setStateLabel();
syncBg(false);

function setPreview(kind){
  if (lock) return;
  scene.classList.toggle("preview-couleurs",   kind === "couleurs");
  scene.classList.toggle("preview-esculturas", kind === "esculturas");
  scene.classList.toggle("preview-photos",     kind === "photos");
  syncBg(kind === "couleurs");
  fitAll();
}
function clearPreview(){
  if (lock) return;
  scene.classList.remove("preview-couleurs","preview-esculturas","preview-photos");
  syncBg(false);
  fitAll();
}

function setLock(kind){
  lock = kind;
  if (isLightboxOpen()) closeLightbox();

  scene.classList.remove("preview-couleurs","preview-esculturas","preview-photos");
  scene.classList.toggle("lock-couleurs",   kind === "couleurs");
  scene.classList.toggle("lock-esculturas", kind === "esculturas");
  scene.classList.toggle("lock-photos",     kind === "photos");

  setStateLabel();
  syncBg(false);
  fitAll();
}

function clearLock(){
  lock = null;
  if (isLightboxOpen()) closeLightbox();

  scene.classList.remove("lock-couleurs","lock-esculturas","lock-photos");
  scene.classList.remove("preview-couleurs","preview-esculturas","preview-photos");
  setStateLabel();
  syncBg(false);
  fitAll();
}

/* Hover desktop */
cell2.addEventListener("mouseenter", () => setPreview("couleurs"));
cell2.addEventListener("mouseleave", clearPreview);
cell3.addEventListener("mouseenter", () => setPreview("esculturas"));
cell3.addEventListener("mouseleave", clearPreview);
cell4.addEventListener("mouseenter", () => setPreview("photos"));
cell4.addEventListener("mouseleave", clearPreview);

/* Clic zones */
cell2.querySelector(".hotspot").addEventListener("click", (e)=>{ e.preventDefault(); setLock("couleurs"); });
cell3.querySelector(".hotspot").addEventListener("click", (e)=>{ e.preventDefault(); setLock("esculturas"); });
cell4.querySelector(".hotspot").addEventListener("click", (e)=>{ e.preventDefault(); setLock("photos"); });

/* Menu */
function stop(e){ e.preventDefault(); }
navHome.addEventListener("click", clearLock);
navCouleurs.addEventListener("click", ()=>setLock("couleurs"));
navEsculturas.addEventListener("click", ()=>setLock("esculturas"));
navPhotos.addEventListener("click", ()=>setLock("photos"));
homeLink.addEventListener("click", (e)=>{ stop(e); clearLock(); });

/* Clavier */
window.addEventListener("keydown", (e) => {
  if (isLightboxOpen()){
    if (e.key === "Escape"){ e.preventDefault(); closeLightbox(); }
    if (e.key === "ArrowLeft"){ e.preventDefault(); prevImage(); }
    if (e.key === "ArrowRight"){ e.preventDefault(); nextImage(); }
    return;
  }
  if (e.key === "Escape" && lock){ e.preventDefault(); clearLock(); }
});

/* =========================
   5) FIT RESPONSIVE (aucun scroll)
   ========================= */
function px(n){ return Math.max(0, Math.floor(n)); }

function setHeaderH(){
  const h = headerEl.getBoundingClientRect().height;
  document.documentElement.style.setProperty("--headerH", px(h) + "px");
}

function fitElementToStage(el, cssVarName, extraPad=0){
  if (!el) return;

  const stageRect = stageEl.getBoundingClientRect();
  const availW = stageRect.width  - extraPad*2;
  const availH = stageRect.height - extraPad*2;

  const prevTransform = el.style.transform;
  el.style.transform = "none";
  const r = el.getBoundingClientRect();
  el.style.transform = prevTransform;

  const w = r.width;
  const h = r.height;
  if (!w || !h || !availW || !availH) return;

  let s = Math.min(availW / w, availH / h);
  s = Math.min(s, 1);

  document.documentElement.style.setProperty(cssVarName, String(s));
}

function fitAll(){
  setHeaderH();
  fitElementToStage(mosaic, "--homeFit", 0);

  const showCouleurs =
    scene.classList.contains("preview-couleurs") ||
    scene.classList.contains("lock-couleurs");
  if (showCouleurs){
    fitElementToStage(couleursEl, "--couleursFit", 0);
  }

  const showEsc =
    scene.classList.contains("preview-esculturas") ||
    scene.classList.contains("lock-esculturas");
  if (showEsc){
    fitElementToStage(esculturasEl, "--esculturasFit", 0);
  }
}

const ro = new ResizeObserver(()=>fitAll());
ro.observe(document.documentElement);
ro.observe(headerEl);
ro.observe(stageEl);

window.addEventListener("load", ()=>{
  fitAll();
  setTimeout(fitAll, 120);
});
window.addEventListener("resize", ()=>fitAll(), {passive:true});
window.addEventListener("orientationchange", ()=>setTimeout(fitAll, 120));

["i1","i2","i3","i4"].forEach(id=>{
  const im = document.getElementById(id);
  im?.addEventListener("load", ()=>fitAll());
});
obraGrid.addEventListener("load", (e)=>{
  if (e.target && e.target.tagName === "IMG") fitAll();
}, true);
escGrid.addEventListener("load", (e)=>{
  if (e.target && e.target.tagName === "IMG") fitAll();
}, true);

/* =========================
   6) Micro-parallax + inertie
   ========================= */
const prefersReduced = window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches;

let tx=0, ty=0, cx=0, cy=0;
let tTiltX=0, tTiltY=0, cTiltX=0, cTiltY=0;

function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

function setTargetsFromNormalized(nx, ny){
  const r = stageEl.getBoundingClientRect();
  const minSide = Math.min(r.width, r.height);

  const factor = Math.max(0, Math.min(1, (minSide - 420) / 480));
  const maxShift = 10 * factor;     // px
  const maxTilt  = 1.2 * factor;    // deg

  tx = nx * maxShift;
  ty = ny * maxShift;
  tTiltY = nx * maxTilt;
  tTiltX = -ny * maxTilt;
}

function animateParallax(){
  if (prefersReduced) return;
  const k = 0.08;

  cx += (tx - cx) * k;
  cy += (ty - cy) * k;
  cTiltX += (tTiltX - cTiltX) * k;
  cTiltY += (tTiltY - cTiltY) * k;

  document.documentElement.style.setProperty("--parX", cx.toFixed(2) + "px");
  document.documentElement.style.setProperty("--parY", cy.toFixed(2) + "px");
  document.documentElement.style.setProperty("--tiltX", cTiltX.toFixed(3) + "deg");
  document.documentElement.style.setProperty("--tiltY", cTiltY.toFixed(3) + "deg");

  requestAnimationFrame(animateParallax);
}
requestAnimationFrame(animateParallax);

stageEl.addEventListener("mousemove", (e)=>{
  if (prefersReduced) return;
  const r = stageEl.getBoundingClientRect();
  const x = (e.clientX - r.left) / r.width;
  const y = (e.clientY - r.top)  / r.height;
  const nx = clamp((x - 0.5) * 2, -1, 1);
  const ny = clamp((y - 0.5) * 2, -1, 1);

  if (lock === "couleurs" || lock === "esculturas") { setTargetsFromNormalized(0,0); return; }
  setTargetsFromNormalized(nx, ny);
},{passive:true});

stageEl.addEventListener("mouseleave", ()=>{
  if (prefersReduced) return;
  setTargetsFromNormalized(0, 0);
},{passive:true});

window.addEventListener("deviceorientation", (e)=>{
  if (prefersReduced) return;
  if (lock === "couleurs" || lock === "esculturas") { setTargetsFromNormalized(0,0); return; }

  const g = clamp((e.gamma || 0) / 25, -1, 1);
  const b = clamp((e.beta  || 0) / 25, -1, 1);
  setTargetsFromNormalized(g, b * 0.6);
},{passive:true});

/* =========================
   7) Plein écran immersif
   ========================= */
function isFullscreen(){ return !!document.fullscreenElement; }

async function toggleFullscreen(){
  try{
    if (!isFullscreen()){
      await document.documentElement.requestFullscreen({ navigationUI: "hide" });
    }else{
      await document.exitFullscreen();
    }
  }catch(_){}
}
navFull.addEventListener("click", toggleFullscreen);

document.addEventListener("fullscreenchange", ()=>{
  navFull.setAttribute("aria-pressed", String(isFullscreen()));
  fitAll();
});
</script>

</body>
</html>
